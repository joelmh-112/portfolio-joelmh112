---
import FormGroup from "../../components/ui/FormGroup.astro";
import Input from "../../components/ui/Input.astro";
import Button from "../../components/ui/Button.astro";
import Layout from "@/layouts/Layout.astro";
---

<Layout title="Login">
  <div class="flex items-center justify-center">
    <form
      id="login-email-form"
      class="bg-gray-900 bg-opacity-80 p-8 rounded-xl shadow-lg flex flex-col gap-6 w-full max-w-sm border border-primary border-opacity-30"
    >
      <h1 class="text-3xl font-oswald text-primary text-center mb-2">Iniciar sesi贸n</h1>
      <FormGroup label="Email" id="email">
        <Input id="email" name="email" type="email" placeholder="tu@email.com" required />
      </FormGroup>
      <Button type="submit" className="w-full mt-2">Enviar c贸digo</Button>
    </form>
    <script>
      import { API_URL } from "astro:env/client";
      const form = document.getElementById("login-email-form") as HTMLFormElement | null;
      if (!form) {
        throw new Error("No se encontr贸 el formulario");
      }
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const email = form.elements["email"].value.trim();
        try {
          const res = await fetch(`${API_URL}/auth/send-code`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email }),
          });
          if (res.ok) {
            window.location.href = "/brain/login-code/" + encodeURIComponent(email);
          } else {
            alert("Error enviando el c贸digo.");
          }
        } catch (err) {
          console.log(err);
          alert("Error de red.");
        }
      });
    </script>
  </div>
</L>
